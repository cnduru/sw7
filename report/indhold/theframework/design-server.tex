\section{Server Architecture}
\label{sec:server}
With the prototyping of \Cref{sec:game} we can design a server architecture to accommodate the described features. In this section we will first describe the overall architecture and then look at the individual components.

The server is structured in three layers: a dispatcher service, a logic layer and a data layer. Because we wanted to develop a framework for creating future location-based games, we had to make a decision how to achieve this goal. We could not interleave framework-specific functionality with the specific game we developed along side our framework. The result was these three layers. We wanted to build a communication layer to handle the interface between the client and the server and a data layer to handle the interface between the server and the database. These two layers were chosen rather intuitively early in the design process. Our next choice was how to choose a way to implement a specific game capable of using the framework, while still being scalable and encapsulated. We decided to make the threaded class called game thread handle all game-specific calculations, logics and responses. 
It was helpful to build a game alongside the framework, this helped us to figure out the need for a service to handle timed events in the framework, which resulted in the Event Timer. We also discovered the need for unit to handle client requests that requested functionality prior to the game thread. This was requests like logging in, and seeing all active games, which cannot be handled by a game thread yet since it might not be created yet. The result was the Admin. The Event Timer and the Admin are both positioned in the Logic Layer, because they help make logical decisions based on requests made by the client. 

%Server Architecture
\input{indhold/theframework/DesignServer/serverarchitecture}

%Dispatcher Service
\section{Dispatcher Service}
This layer is responsible for communication with the between client and server, this responsibility is divided between an IO module and a Dispatcher. In this section we will first examine Synchronous and Asynchronous IO in order to determine which is best suited for this framework and then the Dispatcher which forwards messages to the Logic Layer. We decided on Asynchronous IO and base our design on \cite{?} 	 %http://msdn.microsoft.com/en-us/library/fx6588te%28v=vs.110%29.aspx




\input{indhold/theframework/DesignServer/blockingvsnonblocking}
\input{indhold/theframework/DesignServer/dispatcher}

%Logic Layer
\section{Logic Layer}
This layer parses and reacts to the messages received from the dispatcher. The logic layer interact with the game threads and consists of the Event Timer module which is callable from the game threads and can do a callback at a later time. The layer also contains the Admin module responsible for creating game threads as well as non-game specifics such as authenticating logins.
\input{indhold/theframework/DesignServer/admin}
\input{indhold/theframework/DesignServer/eventtimer}

%Game Block
\section{Game Block}
\input{indhold/theframework/DesignServer/gamethread}

%Data Layer
\section{Data Layer}
\input{indhold/theframework/DesignServer/databasedesign}


\section{Design}
